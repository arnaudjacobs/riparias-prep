---
title: "pond_prioritisation"
author: "Bram D'hondt"
date: '2022-05-23'
output: html_document
---

```{r libraries}
library(sf)
library(rgdal)
library(httr)
library(tidyverse)
```

# OBSERVATIONS

Read in observations of Riparias species in Riparias area.

TO CHECK: Are these all the species of the Riparias checklist (this file was made by Sander)?

```{r}
branch <- "41_extending_baseline_map"

current_state <- readOGR(paste0("https://github.com/inbo/riparias-prep/raw/", branch, "/data/spatial/baseline/current_state.geojson"), stringsAsFactors = FALSE)

baseline_state <- readOGR(paste0("https://github.com/inbo/riparias-prep/raw/", branch, "/data/spatial/baseline/baseline.geojson"), stringsAsFactors = FALSE)
```

# FLANDERS

As there is no true need to merge the geographic data from the three regions, which use different formats, the three regions are dealt with apart from one another.

```{r}
crs_wgs <- CRS("+proj=longlat +datum=WGS84 +no_defs")
```

```{r read}
Wb_Vlaanderen <- readOGR("./data/spatial/watervlakken/watervlakken.shp") # returns sp-object
```

```{r transform}
st_crs(Wb_Vlaanderen)
Wb_Vlaanderen <- spTransform(Wb_Vlaanderen, crs_wgs)
```

```{r optional.buffer}
```

```{r intersect map with observations}
output <- raster::intersect(current_state,Wb_Vlaanderen) # Zware berekening. Risico op vastlopen !!
output_VLA <- as.data.frame(output@data)
```

```{r}
final_result <- output_data %>%
  select(scientific_name, waterbody_name, year)%>%
  group_by()%>%
  summarize() # afhankelijk van wat geanalyzeerd moet worden
```

# WALLONIA

```{r read}
Wb_WAL <- st_read("./data/spatial/watervlakken/Plans_eau_PICEA_pourBDREF.gdb") # returns sf-object
```

```{r transform}
st_crs(Wb_WAL)#check projectie
Wb_WAL <- st_transform(Wb_WAL, crs_wgs)
```

```{r optional.buffer}
```

# BRUSSELS

```{r read}
WFS_BRU <- "https://wfs.environnement.brussels/belb?REQUEST=GetCapabilities&SERVICE=WFS"

url <- parse_url(WFS_BRU)
url$query <- list(service = "wfs",
                  #version = "2.0.0", # facultative
                  request = "GetCapabilities"
)
request <- build_url(url)
request

Wb_Brussel<-read_sf(request, layer="Water_surface") # returns sf-object
```

```{r transform}
st_crs(Wb_Brussel)
Wb_Brussel <- st_transform(Wb_Brussel, crs_wgs)
```

```{r optional.buffer}
```