---
title: "Riparias - Baseline"
author: "Sander Devisscher"
date: "`r Sys.time()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r libraries, include=FALSE}
library(rgdal)
library(rgeos)
library(sp)
library(raster)
library(leaflet)
library(tidyverse)
library(knitr)

crs_wgs <- CRS("+proj=longlat +datum=WGS84 +no_defs")
```

```{r get perimeter shape, include = FALSE}
perimeter_shape <- readOGR("./data/spatial/perimeter", "Riparias_Official_StudyArea", stringsAsFactors = FALSE)

perimeter_shape <- spTransform(perimeter_shape, crs_wgs)

bbox <- as.data.frame(perimeter_shape@bbox)
```

```{r test perimeter, eval = FALSE}
leaflet(perimeter_shape) %>% 
  addTiles() %>% 
  addPolylines()
```

```{r get pointdata, include = FALSE}
pointdata <- readOGR("./data/spatial/baseline", "t2_ALL_points_Batch2_1_3", stringsAsFactors = FALSE)
```

```{r test points, eval = FALSE}
leaflet(pointdata) %>% 
  addTiles() %>% 
  addCircleMarkers()
```

```{r intersect with perimeter, include = FALSE}
points_in_perimeter <- raster::intersect(pointdata, perimeter_shape)

points_in_perimeter@data <- points_in_perimeter@data %>% 
  mutate(popup = paste0("Species: ", gbfp_SN, "<br>",
                        "Year: ", year, "<br>",
                        "Dataset: <a href=", datstID, ">", datstID, "</a><br>",
                        "Source: ", Source, "<br>",
                        recrdrl, "GBIF record</a>"))

writeOGR(points_in_perimeter, dsn = "./data/spatial/baseline/points_in_perimeter.geojson", layer = "points_in_perimeter", driver = "GeoJSON", overwrite_layer = TRUE)
```
