
This script downloads all occurences of a list plants commonly found in plantshops 
in Belgium from gbif. Species who do not have occurences in Belgium yet are 
linked to a climate zone defined by Koppen Geiger. Finally a specieslist 
consisting of species that have at least x occurrences, which represent at least
y% of the total number of species occurrences, in the climate zones of Belgium, 
is created. 
Climate matching is done for 2 scenarios. One representing the current climate
and one the future climate according to KÃ¶ppen Geiger. 

```{r setup}
library(googlesheets4)
library(tidyverse)

library(devtools)
install_github("trias-project/trias", ref = "73_climate_matching_function")

library(trias)
```

```{r FUN check}
check <- function(x){
  tryCatch(if(class(x) == 'logical') 1 else 1, error=function(e) 0)
} 
```

```{r FUN get_cred}
get_cred <- function(x){
  library(svDialogs)
  
  cred <- Sys.getenv(x)
  
  if(cred == ""){
    input <- dlgInput(paste0("What is your ", x, "?"))
    cred <- input$res
    Sys.setenv(x = cred)
  }
  return(cred)
}
```

```{r read species list}
gsheet_email <- get_cred("gsheet_email")

gs4_auth(email = gsheet_email)

White_list <- read_sheet("18HNS3HCNbhvTWIn-6iJHQXsPQbfBtOnNZHi7vZRyYDk", 
                         sheet = 1,
                         col_types = "c")

White_list_redux <- White_list %>%
  filter(!is.na(taxonKey)) %>% 
  mutate(Key = as.integer(taxonKey))

table(White_list_redux$`Taxon category`)
taxonkeys <- as.integer(unique(White_list_redux$taxonKey))
```

```{r run climate matching function}
output <- climate_match(region = "Belgium",
                        taxonkey = taxonkeys,
                        BasisOfRecord = c("HUMAN_OBSERVATION", "PRESERVED_SPECIMEN", "UNKNOWN"))
```

